<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sweepify — AI Background Reports</title>
  <meta name="description" content="Answer a few questions to get a comprehensive background report powered by AI." />
  
  <style>
    :root{
      --bg:#0a0f1e;
      --card:#141b2e;
      --muted:#94a3b8;
      --text:#f1f5f9;
      --accent:#3b82f6;
      --accent2:#8b5cf6;
      --ok:#10b981;
      --border:rgba(255,255,255,.08);
      --shadow:0 20px 60px rgba(0,0,0,.5);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      color:var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background:
        radial-gradient(1400px 700px at 15% -15%, rgba(59,130,246,.15) 0%, transparent 70%),
        var(--bg);
      min-height:100vh;display:flex;align-items:center;justify-content:center;
      padding:20px;
    }
    
    /* Quiz Container */
    .quiz-container{
      max-width:650px;width:100%;
      background:var(--card);border-radius:24px;
      border:1px solid var(--border);box-shadow:var(--shadow);
      padding:50px 40px;text-align:center;position:relative;
    }
    @media(max-width:640px){.quiz-container{padding:40px 24px}}

    /* Logo */
    .logo{
      width:50px;height:50px;margin:0 auto 20px;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      border-radius:14px;display:flex;align-items:center;justify-content:center;
      font-weight:900;font-size:26px;box-shadow:0 10px 30px rgba(59,130,246,.35);
    }

    /* Progress */
    .progress-bar{
      height:6px;background:rgba(255,255,255,.05);border-radius:10px;
      margin-bottom:30px;overflow:hidden;
    }
    .progress-fill{
      height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));
      width:0%;transition:width .5s ease;border-radius:10px;
    }
    .step-count{font-size:13px;color:var(--muted);margin-bottom:20px}

    /* Step content */
    .step{display:none;animation:fadeIn .4s}
    .step.active{display:block}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    
    .step h2{font-size:28px;margin-bottom:12px;line-height:1.2}
    @media(max-width:640px){.step h2{font-size:24px}}
    .step p{color:var(--muted);font-size:15px;margin-bottom:30px;line-height:1.5}

    /* Input styles */
    input,select{
      width:100%;padding:16px 18px;border-radius:14px;
      border:1px solid var(--border);background:rgba(255,255,255,.03);
      color:var(--text);font-size:16px;transition:all .2s;outline:none;
      text-align:center;
    }
    input:focus,select:focus{
      border-color:var(--accent);box-shadow:0 0 0 4px rgba(59,130,246,.1);
    }
    input::placeholder{color:#475569}

    /* Buttons */
    .btn{
      padding:16px 32px;border-radius:14px;font-size:16px;font-weight:700;
      border:none;cursor:pointer;transition:all .3s;
    }
    .btn-primary{
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      color:#fff;box-shadow:0 8px 20px rgba(59,130,246,.3);
      width:100%;margin-top:25px;
    }
    .btn-primary:hover{transform:translateY(-2px);box-shadow:0 12px 30px rgba(59,130,246,.4)}
    .btn-primary:disabled{opacity:.5;cursor:not-allowed;transform:none}
    
    .btn-secondary{
      background:transparent;color:var(--muted);
      border:1px solid var(--border);padding:12px 24px;font-size:14px;
      margin-top:15px;
    }
    .btn-secondary:hover{background:rgba(255,255,255,.05)}

    /* Options grid */
    .options{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:25px}
    @media(max-width:640px){.options{grid-template-columns:1fr}}
    .option{
      padding:18px;border-radius:14px;border:2px solid var(--border);
      background:rgba(255,255,255,.02);cursor:pointer;transition:all .3s;
      text-align:left;
    }
    .option:hover{border-color:rgba(59,130,246,.4);transform:translateY(-2px)}
    .option.selected{
      border-color:var(--accent);background:rgba(59,130,246,.08);
      box-shadow:0 6px 20px rgba(59,130,246,.2);
    }
    .option .icon{font-size:24px;margin-bottom:8px}
    .option .title{font-weight:700;font-size:15px;margin-bottom:4px}
    .option .desc{font-size:13px;color:var(--muted);line-height:1.4}

    /* Pricing tiers */
    .tiers{display:grid;gap:14px;margin-top:25px}
    .tier{
      padding:20px;border-radius:16px;border:2px solid var(--border);
      background:rgba(255,255,255,.02);cursor:pointer;transition:all .3s;
      text-align:left;position:relative;
    }
    .tier:hover{border-color:rgba(59,130,246,.4);transform:translateY(-2px)}
    .tier.selected{
      border-color:var(--accent);background:rgba(59,130,246,.08);
      box-shadow:0 8px 20px rgba(59,130,246,.2);
    }
    .tier .badge{
      position:absolute;top:-10px;right:15px;padding:4px 12px;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      border-radius:12px;font-size:11px;font-weight:900;text-transform:uppercase;
      color:#fff;letter-spacing:.5px;
    }
    .tier .tier-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .tier .tier-name{font-weight:700;font-size:17px}
    .tier .price{font-size:32px;font-weight:900;letter-spacing:-1px}
    .tier .price span{font-size:15px;font-weight:400;color:var(--muted)}
    .tier ul{list-style:none;font-size:13px;color:var(--muted);margin-top:10px}
    .tier ul li{padding:5px 0;display:flex;gap:8px}
    .tier ul li::before{content:'✓';color:var(--ok);font-weight:900;flex-shrink:0}

    /* Loading animation */
    .loading-screen{
      display:none;text-align:center;padding:40px 0;
    }
    .loading-screen.active{display:block}
    .spinner-big{
      width:60px;height:60px;border:4px solid rgba(59,130,246,.2);
      border-top-color:var(--accent);border-radius:50%;
      animation:spin 1s linear infinite;margin:0 auto 25px;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .loading-text{font-size:18px;font-weight:600;margin-bottom:10px}
    .loading-subtext{color:var(--muted);font-size:14px}

    /* Hidden by default */
    .hidden{display:none!important}
  </style>
</head>
<body>
  <div class="quiz-container">
    <div class="logo">S</div>
    
    <!-- Progress -->
    <div class="step-count">Question <span id="currentStep">1</span> of <span id="totalSteps">7</span></div>
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>

    <!-- Step 1: Name -->
    <div class="step active" data-step="1">
      <h2>Let's start with the basics</h2>
      <p>What's the person's full name you want to research?</p>
      <input type="text" id="firstname" placeholder="First name" required />
      <input type="text" id="lastname" placeholder="Last name" style="margin-top:12px" required />
      <button class="btn btn-primary" onclick="nextStep()">Continue</button>
    </div>

    <!-- Step 2: Location -->
    <div class="step" data-step="2">
      <h2>Where are they located?</h2>
      <p>This helps us narrow down the search significantly</p>
      <input type="text" id="city" placeholder="City (e.g., New York)" required />
      <select id="age_range" style="margin-top:12px" required>
        <option value="">Select age range</option>
        <option value="18-24">18-24</option>
        <option value="25-34">25-34</option>
        <option value="35-44">35-44</option>
        <option value="45-54">45-54</option>
        <option value="55-64">55-64</option>
        <option value="65+">65+</option>
      </select>
      <button class="btn btn-primary" onclick="nextStep()">Continue</button>
      <button class="btn btn-secondary" onclick="prevStep()">Back</button>
    </div>

    <!-- Step 3: Social handles -->
    <div class="step" data-step="3">
      <h2>Do you know any social media handles?</h2>
      <p>This greatly improves accuracy (optional but recommended)</p>
      <input type="text" id="social_media" placeholder="@username or profile link" />
      <button class="btn btn-primary" onclick="nextStep()">Continue</button>
      <button class="btn btn-secondary" onclick="prevStep()">Back</button>
    </div>

    <!-- Step 4: Aliases -->
    <div class="step" data-step="4">
      <h2>Any known nicknames or aliases?</h2>
      <p>People often use different names online</p>
      <input type="text" id="alias" placeholder="e.g., Johnny, JD (optional)" />
      <button class="btn btn-primary" onclick="nextStep()">Continue</button>
      <button class="btn btn-secondary" onclick="prevStep()">Back</button>
    </div>

    <!-- Step 5: Email -->
    <div class="step" data-step="5">
      <h2>Know their email address?</h2>
      <p>This can unlock additional public records</p>
      <input type="email" id="email_cheater" placeholder="their-email@example.com (optional)" />
      <button class="btn btn-primary" onclick="nextStep()">Continue</button>
      <button class="btn btn-secondary" onclick="prevStep()">Back</button>
    </div>

    <!-- Step 6: Your email -->
    <div class="step" data-step="6">
      <h2>Where should we send the report?</h2>
      <p>Your email address (we'll never share it)</p>
      <input type="email" id="email" placeholder="your-email@example.com" required />
      <button class="btn btn-primary" onclick="nextStep()">Continue</button>
      <button class="btn btn-secondary" onclick="prevStep()">Back</button>
    </div>

    <!-- Step 7: Pricing -->
    <div class="step" data-step="7">
      <h2>Choose your report depth</h2>
      <p>Select the level of detail you need</p>
      
      <div class="tiers">
        <div class="tier" data-tier="basic" data-price="4.99" onclick="selectTier(this)">
          <div class="tier-header">
            <div class="tier-name">Basic</div>
            <div class="price">€4.99</div>
          </div>
          <ul>
            <li>Profile discovery</li>
            <li>Public records summary</li>
            <li>24-hour delivery</li>
          </ul>
        </div>

        <div class="tier selected" data-tier="standard" data-price="14.99" onclick="selectTier(this)">
          <div class="badge">Most Popular</div>
          <div class="tier-header">
            <div class="tier-name">Standard</div>
            <div class="price">€14.99</div>
          </div>
          <ul>
            <li>Deep profile search</li>
            <li>Social media links</li>
            <li>Enhanced signals</li>
            <li>12-hour delivery</li>
          </ul>
        </div>

        <div class="tier" data-tier="premium" data-price="17.99" onclick="selectTier(this)">
          <div class="badge">Max Depth</div>
          <div class="tier-header">
            <div class="tier-name">Premium</div>
            <div class="price">€17.99</div>
          </div>
          <ul>
            <li>Maximum depth analysis</li>
            <li>All public sources</li>
            <li>Detailed timeline</li>
            <li>Priority delivery (6h)</li>
          </ul>
        </div>
      </div>

      <button class="btn btn-primary" onclick="submitForm()">Get My Report</button>
      <button class="btn btn-secondary" onclick="prevStep()">Back</button>
    </div>

    <!-- Loading -->
    <div class="loading-screen" id="loadingScreen">
      <div class="spinner-big"></div>
      <div class="loading-text">Preparing your report...</div>
      <div class="loading-subtext">This will only take a moment</div>
    </div>
  </div>

  <script>
    function safeFbq(action, event, params) {
      if (typeof fbq !== 'undefined') fbq(action, event, params);
    }
  </script>

  <script>
    const WHICH_LP = 'find_v3';
    const TOTAL_STEPS = 7;
    
    let currentStep = 1;
    let selectedTier = 'standard';
    let selectedPrice = 14.99;

    // Attribution
    const qs = new URLSearchParams(location.search);
    const get = (k) => qs.get(k) || '';
    const attribution = {
      from: get('from') || '',
      which_lp: WHICH_LP,
      fbclid: get('fbclid'),
      gclid: get('gclid'),
      utm_source: get('utm_source'),
      utm_campaign: get('utm_campaign'),
      utm_content: get('utm_content'),
    };

    try {
      localStorage.setItem('sweepify_attrib', JSON.stringify(attribution));
    } catch {}

    // ViewContent
    setTimeout(() => {
      safeFbq('track', 'ViewContent', {
        content_name: 'lp_quiz_v3',
        which_lp: WHICH_LP,
        from: attribution.from,
        currency: 'EUR'
      });
    }, 1000);

    function updateProgress() {
      const progress = (currentStep / TOTAL_STEPS) * 100;
      document.getElementById('progressFill').style.width = progress + '%';
      document.getElementById('currentStep').textContent = currentStep;
      document.getElementById('totalSteps').textContent = TOTAL_STEPS;
    }

    function nextStep() {
      // Validate current step
      const step = document.querySelector(`.step[data-step="${currentStep}"]`);
      const inputs = step.querySelectorAll('input[required], select[required]');
      
      for (let input of inputs) {
        if (!input.value.trim()) {
          input.focus();
          return;
        }
      }

      if (currentStep < TOTAL_STEPS) {
        document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
        currentStep++;
        document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');
        updateProgress();
      }
    }

    function prevStep() {
      if (currentStep > 1) {
        document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
        currentStep--;
        document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');
        updateProgress();
      }
    }

    function selectTier(element) {
      document.querySelectorAll('.tier').forEach(t => t.classList.remove('selected'));
      element.classList.add('selected');
      selectedTier = element.dataset.tier;
      selectedPrice = parseFloat(element.dataset.price);
      
      safeFbq('track', 'AddToCart', {
        content_name: selectedTier,
        value: selectedPrice,
        currency: 'EUR',
        which_lp: WHICH_LP,
        from: attribution.from,
      });
    }

    async function submitForm() {
      safeFbq('track', 'InitiateCheckout', {
        content_name: selectedTier,
        value: selectedPrice,
        currency: 'EUR',
        which_lp: WHICH_LP,
        from: attribution.from,
      });

      // Show loading
      document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
      document.getElementById('loadingScreen').classList.add('active');

      const payload = {
        email: document.getElementById('email').value.trim(),
        firstname: document.getElementById('firstname').value.trim(),
        lastname: document.getElementById('lastname').value.trim(),
        city: document.getElementById('city').value.trim(),
        age_range: document.getElementById('age_range').value,
        alias: document.getElementById('alias').value.trim(),
        social_media: document.getElementById('social_media').value.trim(),
        email_cheater: document.getElementById('email_cheater').value.trim(),
        report_type: selectedTier,
        tier: selectedTier,
        which_lp: WHICH_LP,
        from: attribution.from,
        fbclid: attribution.fbclid,
        gclid: attribution.gclid,
        utm_source: attribution.utm_source,
        utm_campaign: attribution.utm_campaign,
        source_url: location.href,
      };

      try {
        const res = await fetch('https://sweepify-session.sherymadodomy.workers.dev/create-session', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });
        
        const data = await res.json().catch(() => null);
        
        if (!res.ok || !data?.checkout_url) {
          throw new Error('checkout-failed');
        }
        
        window.location.href = data.checkout_url;
      } catch (err) {
        document.getElementById('loadingScreen').classList.remove('active');
        document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');
        alert('Unable to process checkout. Please try again.');
      }
    }

    updateProgress();
  </script>
</body>
</html>
